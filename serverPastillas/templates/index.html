<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Your Website</title>
<style>
html, body {
  padding: 0;
  margin: 0;
  background-color: #667788;
  color: #efefef;
  font-family: "Open Sans";
}

.container {
  box-sizing: border-box;
  padding: 40px;
  text-align: center;
}
.container h2 {
  justify-content: space-around;
}
.container p {
  margin-top: 40px;
}

.container_hijo {
  text-align: center;
  display: inline-block;
  margin: 1%;
}

/* Checkmark style starts */
@-moz-keyframes dothabottomcheck {
  0% {
    height: 0;
  }
  100% {
    height: 50px;
  }
}
@-webkit-keyframes dothabottomcheck {
  0% {
    height: 0;
  }
  100% {
    height: 50px;
  }
}
@keyframes dothabottomcheck {
  0% {
    height: 0;
  }
  100% {
    height: 33.3333333333px;
  }
}
@keyframes dothatopcheck {
  0% {
    height: 0;
  }
  50% {
    height: 0;
  }
  100% {
    height: 80px;
  }
}
@-webkit-keyframes dothatopcheck {
  0% {
    height: 0;
  }
  50% {
    height: 0;
  }
  100% {
    height: 120px;
  }
}
@-moz-keyframes dothatopcheck {
  0% {
    height: 0;
  }
  50% {
    height: 0;
  }
  100% {
    height: 120px;
  }
}
input[type=checkbox] {
  display: none;
}

.check-box {
  height: 100px;
  width: 100px;
  background-color: transparent;
  border: 10px solid #000;
  border-radius: 5px;
  position: relative;
  display: inline-block;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  -moz-transition: border-color ease 0.2s;
  -o-transition: border-color ease 0.2s;
  -webkit-transition: border-color ease 0.2s;
  transition: border-color ease 0.2s;
  cursor: pointer;
}
.check-box::before, .check-box::after {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  position: absolute;
  height: 0;
  width: 20px;
  background-color: #34b93d;
  display: inline-block;
  -moz-transform-origin: left top;
  -ms-transform-origin: left top;
  -o-transform-origin: left top;
  -webkit-transform-origin: left top;
  transform-origin: left top;
  border-radius: 5px;
  content: " ";
  -webkit-transition: opacity ease 0.5;
  -moz-transition: opacity ease 0.5;
  transition: opacity ease 0.5;
}
.check-box::before {
  top: 72px;
  left: 31px;
  box-shadow: 0 0 0 5px #667788;
  -moz-transform: rotate(-135deg);
  -ms-transform: rotate(-135deg);
  -o-transform: rotate(-135deg);
  -webkit-transform: rotate(-135deg);
  transform: rotate(-135deg);
}
.check-box::after {
  top: 47px;
  left: 5px;
  -moz-transform: rotate(-45deg);
  -ms-transform: rotate(-45deg);
  -o-transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
  transform: rotate(-45deg);
}

input[type=checkbox]:checked + .check-box,
.check-box.checked {
  border-color: #34b93d;
}
input[type=checkbox]:checked + .check-box::after,
.check-box.checked::after {
  height: 50px;
  -moz-animation: dothabottomcheck 0.2s ease 0s forwards;
  -o-animation: dothabottomcheck 0.2s ease 0s forwards;
  -webkit-animation: dothabottomcheck 0.2s ease 0s forwards;
  animation: dothabottomcheck 0.2s ease 0s forwards;
}
input[type=checkbox]:checked + .check-box::before,
.check-box.checked::before {
  height: 120px;
  -moz-animation: dothatopcheck 0.4s ease 0s forwards;
  -o-animation: dothatopcheck 0.4s ease 0s forwards;
  -webkit-animation: dothatopcheck 0.4s ease 0s forwards;
  animation: dothatopcheck 0.4s ease 0s forwards;
}
</style>
</head>
	<script type="text/javascript">

		var getUrl = window.location
		var baseUrl = getUrl.protocol + "//" + getUrl.hostname + ":5000"
		var curr_time = 4;
		var time_names = [ 'noche',  'cena', 'comida','desayuno'];
    var week = [['0', '0', '0', '0', '0', '0', '0'],
              ['0', '0', '0', '0', '0', '0', '0'],
              ['0', '0', '0', '0', '0', '0', '0'],
              ['0', '0', '0', '0', '0', '0', '0']];

		const GET_TIME = async () => 
		{
			const response = await fetch(baseUrl + "/time");
			
			return (response);
		}

		const POST_TIME = async () => 
		{
			const formData = new FormData(document.getElementById("time"));
			console.log(formData.get("schedule"))
			fetch('/time', {
				method: 'POST',
				body: JSON.stringify(formData.get("schedule"))
			})
			.then(function(res) 
			{
				curr_time = curr_time - 1;
				console.log(curr_time);
				if (curr_time > 0)
					document.getElementById("main").innerHTML = form_view();
				else 
					submit_controller();
			})
		}

    const POST_WEEK = async () =>
    {
			fetch('/week', {
				method: 'POST',
				body: week});
    }
		
		const form_view = () =>
		{
			return `
	   <h1>${time_names[curr_time - 1]}</h1>
			<form id="time" onsubmit="POST_TIME()" method="post" action="javascript:void(0);" enctype="multipart/form-data">
	   		<input id="schedule" name="schedule" type="time"/>
				<input type="submit" name="subir-datos" value="Submit"/>
			</form>
	`		
		}
		const	week_view= () =>
		{
			return `
      <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <div class="container">
  <div class="container1">
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_1" />
    <label for="cbtest1_1" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_2" />
    <label for="cbtest1_2" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_3" />
    <label for="cbtest1_3" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_4" />
    <label for="cbtest1_4" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_5" />
    <label for="cbtest1_5" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_6" />
    <label for="cbtest1_6" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest1_7" />
    <label for="cbtest1_7" class="check-box"></label>
    </div>
  </div>

  <div class="container1">
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_1" />
    <label for="cbtest2_1" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_2" />
    <label for="cbtest2_2" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_3" />
    <label for="cbtest2_3" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_4" />
    <label for="cbtest2_4" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_5" />
    <label for="cbtest2_5" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_6" />
    <label for="cbtest2_6" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest2_7" />
    <label for="cbtest2_7" class="check-box"></label>
    </div>
  </div>

  <div class="container1">
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_1" />
    <label for="cbtest3_1" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_2" />
    <label for="cbtest3_2" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_3" />
    <label for="cbtest3_3" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_4" />
    <label for="cbtest3_4" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_5" />
    <label for="cbtest3_5" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_6" />
    <label for="cbtest3_6" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest3_7" />
    <label for="cbtest3_7" class="check-box"></label>
    </div>
  </div>

  <div class="container1">
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_1" />
    <label for="cbtest4_1" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_2" />
    <label for="cbtest4_2" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_3" />
    <label for="cbtest4_3" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_4" />
    <label for="cbtest4_4" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_5" />
    <label for="cbtest4_5" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_6" />
    <label for="cbtest4_6" class="check-box"></label>
    </div>
    <div class="container_hijo">
    <input type="checkbox" id="cbtest4_7" />
    <label for="cbtest4_7" class="check-box"></label>
    </div>
  </div>
  <button class="send">Submit</button>
</div>
		`
	}
		const init_view = () =>
		{
			return `
			<h1>Welcome!</h1>
			<div id="initactions">
			<button class="start">Start</button>
			</div>
			`
		}
		const init_controller = async () =>
		{
			document.getElementById("main").innerHTML = init_view();
		}	
		const submit_controller = async () =>
		{
			var time = await GET_TIME();
			var response = await time.json();
        	console.log(response);
			document.getElementById("main").innerHTML = submit_view(response);
		}	
		const submit_view = (time) =>
		{
			return `
			<div class="container">
			<ul>
				<li>Desayuno : ${time["Desayuno"]}</li>
				<li>Comida : ${time["Comida"]}</li>
				<li>Cena : ${time["Cena"]}</li>
				<li>Noche : ${time["Noche"]}</li>
				</ul>
			<button class="week">Save</button>
			</div>
			`
		}
    const add_day = (input) =>
    {
        index = input.id.slice(-3);
        time = parseInt(index.charAt(0), 10) - 1;
        day = parseInt(index.charAt(2),10) - 1;
        week[time][day] = week[time][day] == '1' ? '0' : '1';
        console.log(week);
    }
    function toArray(list) {
    return Array.prototype.slice.call(list);
    }
    const table_controller = () =>
    {
      var rows = toArray(document.getElementsByClassName("container1"));
      rows.forEach(function (row){
          var inputs = toArray(row.getElementsByTagName("input"));
          inputs.forEach(function (input) {
          input.addEventListener("click", function() {add_day(input)})
          }) })
        }
		const week_controller = () => {
			document.getElementById("main").innerHTML = week_view();
      console.log(week);
      table_controller();
		}	
    const submit_week_controller = async() => 
    {
      response = await POST_WEEK();
      console.log("traza semana")
    }
		const form_controller = async () =>
		{
			document.getElementById("main").innerHTML = form_view();
		};
		matchEvent = (ev, sel) => ev.target.matches(sel);
		const myId = (ev) => Number(ev.target.dataset.myId);
		document.addEventListener("click", (ev) => {

			if (matchEvent(ev, ".submit")) submit_controller(myId(ev));
			else if (matchEvent(ev, ".start")) form_controller(myId(ev))
			else if (matchEvent(ev, ".week")) week_controller(myId(ev))
			else if (matchEvent(ev, ".send")) submit_week_controller(myId(ev))

		});
		document.addEventListener("DOMContentLoaded", init_controller);
	</script>

<body>
	<div id="main">
	</div>
</body>

</html>
