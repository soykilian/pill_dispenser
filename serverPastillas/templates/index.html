<!DOCTYPE HTML>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Your Website</title>
<style>
	@import 'https://fonts.googleapis.com/css?family=Poiret+One';
body {
  background: #123456;
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  font-family: "Poiret One", cursive;
  color: #fff;
  font-size: 100%;
  height: 100vh;
}

/* Custom Code Here */
.container {
  max-width: 400px;
}
.container .checkboxes {
  display: flex;
  justify-content: center;
  margin-bottom: 50px;
}
.container .checkboxes + p {
  text-align: center;
}
.container .check input {
  display: none;
}
.container .check input:checked + label .box {
  -webkit-animation: animOnTransform 1s 1 forwards;
          animation: animOnTransform 1s 1 forwards;
  background: rgba(0, 0, 0, 0.5);
}
.container .check input:checked + label .box i {
  transform: translate(-50%, -50%) scale(1);
  transition-duration: 200ms;
  transition-delay: 400ms;
  opacity: 1;
}
.container .check label {
  min-width: 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: row;
  min-height: 60px;
  cursor: pointer;
}
.container .check label .box {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 5px;
  position: relative;
  width: 50px;
  height: 50px;
  transition: background 300ms ease;
}
.container .check label .box:hover {
  background: rgba(0, 0, 0, 0.5);
}
.container .check label .box i {
  position: absolute;
  top: 50%;
  left: 50%;
  font-size: 20px;
  display: inline-block;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s ease-in-out;
  transition-delay: 200ms;
  transform: translate(-50%, -50%) scale(4);
}

@-webkit-keyframes animOn {
  40% {
    height: 20px;
    width: 100px;
  }
  50% {
    height: 60px;
    width: 30px;
  }
  60% {
    height: 40px;
    width: 70px;
  }
  70% {
    height: 55px;
    width: 45px;
  }
  100% {
    height: 50px;
    width: 50px;
  }
}

@keyframes animOn {
  40% {
    height: 20px;
    width: 100px;
  }
  50% {
    height: 60px;
    width: 30px;
  }
  60% {
    height: 40px;
    width: 70px;
  }
  70% {
    height: 55px;
    width: 45px;
  }
  100% {
    height: 50px;
    width: 50px;
  }
}
@-webkit-keyframes animOnTransform {
  40% {
    transform: scale(1.5, 0.5);
  }
  50% {
    transform: scale(0.5, 1.5);
  }
  60% {
    transform: scale(1.3, 0.6);
  }
  70% {
    transform: scale(0.8, 1.2);
  }
  100% {
    transform: scale(1, 1);
  }
}
@keyframes animOnTransform {
  40% {
    transform: scale(1.5, 0.5);
  }
  50% {
    transform: scale(0.5, 1.5);
  }
  60% {
    transform: scale(1.3, 0.6);
  }
  70% {
    transform: scale(0.8, 1.2);
  }
  100% {
    transform: scale(1, 1);
  }
}
	</style>
</head>
	<script type="text/javascript">

		var getUrl = window.location
		var baseUrl = getUrl.protocol + "//" + getUrl.hostname + ":5000"
		var curr_time = 4;
		var time_names = [ 'noche',  'cena', 'comida','desayuno'];

		const GET_TIME = async () => 
		{
			const response = fetch(baseUrl, "/time");
			const data = await response.json();
			return (data);
		};
		const POST_TIME = async () => 
		{
			console.log("traza")
			const formData = new FormData(document.getElementById("time"));
			console.log(formData.get("schedule"))
			fetch('/time', {
				method: 'POST',
				body: JSON.stringify(formData.get("schedule"))
			})
			.then(function(res) 
			{
				curr_time = curr_time - 1;
				console.log(curr_time);
				if (curr_time > 0)
					document.getElementById("main").innerHTML = form_view();
				else 
					document.getElementById("main").innerHTML = week_view();
			})
		}
		
		const form_view = () =>
		{
			return `
	   <h1>${time_names[curr_time - 1]}</h1>
			<form id="time" onsubmit="POST_TIME()" method="post" action="javascript:void(0);" enctype="multipart/form-data">
	   		<input id="schedule" name="schedule" type="time"/>
				<input type="submit" name="subir-datos" value="Submit"/>
			</form>
					`
		}
		const	week_view= () =>
		{
			return `
			<div class="container">
  <div class="checkboxes">
    <div class="check">
      <input id="check" type="checkbox" /><label for="check">
        <div class="box">
          <i class="fa fa-check"></i>
        </div>
      </label>
    </div>
    <div class="check">
      <input id="check1" type="checkbox" /><label for="check1">
        <div class="box">
          <i class="fa fa-check"></i>
        </div>
      </label>
    </div>
    <div class="check">
      <input id="check2" type="checkbox" /><label for="check2">
        <div class="box">
          <i class="fa fa-check"></i>
        </div>
      </label>
    </div>
    <div class="check">
      <input id="check3" type="checkbox" /><label for="check3">
        <div class="box">
          <i class="fa fa-check"></i>
        </div>
      </label>
    </div>
  </div>`
	}
		const init_view = () =>
		{
			return `
			<h1>Welcome!</h1>
			<div id="initactions">
			<button class="start">Start</button>
			</div>
			`
		}
		const init_controller = async () =>
		{
			document.getElementById("main").innerHTML = init_view();
		}	
		const submit_controller = async () =>
		{
			let time = document.getElementById(time_names[curr_time - 1]);
        	console.log(time);
			document.getElementById("main").innerHTML = form_view();
		}	

		const form_controller = async () =>
		{
			document.getElementById("main").innerHTML = form_view();
		};
		matchEvent = (ev, sel) => ev.target.matches(sel);
		const myId = (ev) => Number(ev.target.dataset.myId);
		document.addEventListener("click", (ev) => {

			if (matchEvent(ev, ".submit")) submit_controller(myId(ev));
			else if (matchEvent(ev, ".start")) form_controller(myId(ev))

		});
		$(document).ready(function(){
	console.log('ready!')
	// Custom jQuery Functions Here
})
		document.addEventListener("DOMContentLoaded", init_controller);
	</script>

<body>
	<div id="main">
	</div>
</body>

</html>
